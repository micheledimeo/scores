name: Lint Code

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  eslint:
    name: ESLint
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'

    - name: Install dependencies
      run: npm ci --legacy-peer-deps

    - name: Run ESLint
      run: npm run lint || echo "ESLint not configured"
      continue-on-error: true

  stylelint:
    name: Stylelint
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'

    - name: Install dependencies
      run: npm ci --legacy-peer-deps

    - name: Run Stylelint
      run: npm run stylelint || echo "Stylelint not configured"
      continue-on-error: true

  php-cs-fixer:
    name: PHP Code Style
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'
        tools: php-cs-fixer
        coverage: none

    - name: Run PHP CS Fixer (dry-run)
      run: |
        if [ -f ".php-cs-fixer.php" ]; then
          php-cs-fixer fix --dry-run --diff --verbose
        else
          echo "PHP CS Fixer config not found, skipping"
        fi
      continue-on-error: true

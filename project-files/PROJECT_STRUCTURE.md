# MusicXML Scores - Project Structure and Deployment Guide
**Updated:** November 11, 2025
**App Version:** 0.9.5

## ğŸ“ Project Structure

```
/Users/Michele/Sites/mxmlscores/
â”œâ”€â”€ src/                     # Vue.js source code
â”œâ”€â”€ lib/                     # PHP backend
â”œâ”€â”€ appinfo/                 # App metadata
â”œâ”€â”€ templates/               # HTML templates
â”œâ”€â”€ js/                      # Compiled JavaScript (build output)
â”œâ”€â”€ css/                     # Compiled CSS (build output)
â”œâ”€â”€ screenshots/             # App Store screenshots
â”œâ”€â”€ README.md                # Main app documentation
â”‚
â”œâ”€â”€ scripts/                 # Utility scripts (from utils branch)
â”‚   â”œâ”€â”€ deploy-production.sh
â”‚   â”œâ”€â”€ deploy-and-test.sh
â”‚   â”œâ”€â”€ package-app.sh
â”‚   â”œâ”€â”€ sign-app.sh
â”‚   â”œâ”€â”€ backup.sh
â”‚   â””â”€â”€ update-repo-urls.sh
â”‚
â”œâ”€â”€ docs/                    # Documentation (from utils branch)
â”‚   â”œâ”€â”€ DEPLOY_CHECKLIST.md
â”‚   â”œâ”€â”€ WORKFLOW.md
â”‚   â”œâ”€â”€ GITHUB_SETUP.md
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ project-files/           # Development files (gitignored)
    â”œâ”€â”€ testsprite/          # Test suite
    â”œâ”€â”€ dist/                # Build artifacts and releases
    â”œâ”€â”€ backups/             # App backups
    â”œâ”€â”€ app-certificate-requests/  # Nextcloud CSR PR
    â”œâ”€â”€ CHANGELOG.md         # Release notes
    â”œâ”€â”€ LICENSE              # GNU AGPL v3
    â”œâ”€â”€ TEST_REPORT.md       # Test results
    â””â”€â”€ PROJECT_STRUCTURE.md # This file
```

---

## ğŸ“¦ Deployment Scripts

All deployment scripts are in the `scripts/` folder (from utils branch).

### `scripts/deploy-production.sh` - Production Deployment
**Purpose:** Complete deployment to cloud.ottoniascoppio.org
**Target:** Production server (ottoniascoppio)
**Use When:** All updates (JS, CSS, PHP)

**Usage:**
```bash
cd /Users/Michele/Sites/mxmlscores
./scripts/deploy-production.sh
```

**Steps performed:**
1. Verifies compiled files exist
2. Prepares init-app.js
3. Creates directory structure on server
4. Cleans old deprecated files (mxmlscores-main.js, app.php)
5. Uploads JavaScript (mxml-scores-main.js, init-app.js)
6. Uploads CSS (main.css)
7. Uploads PHP backend (lib/)
8. Uploads appinfo (info.xml, routes.php)
9. Uploads templates (main.php, public.php)
10. Uploads app icon (app.svg)
11. Verifies deployment
12. Sets permissions (ottoniascoppio:ottoniascoppio)
13. Reloads app via OCC
14. Clears Redis cache
15. Final verification (checks app is enabled)

---

## ğŸ”§ Prerequisites

### Before Running Any Script:

1. **Build the app:**
   ```bash
   cd /Users/Michele/Sites/mxmlscores
   npm run build
   ```

2. **Verify files exist:**
   - `js/mxmlscores-main.js`
   - `css/main.css`

3. **SSH access configured:**
   - ottoniascoppio (production)

---

## ğŸ“ Important Notes

### Critical Files:
1. **mxmlscores-main.js** - Generated by `npm run build`
2. **main.css** - Generated by `npm run build`
3. **info.xml** - App metadata with version 0.9.5

### Server Paths:
- **Production:** `/home/ottoniascoppio/domains/cloud.ottoniascoppio.org/public_html/apps/mxmlscores`
- **Local:** `/Users/Michele/Sites/mxmlscores`

### Project Organization:
- **Scripts:** `scripts/` (from utils branch)
- **Documentation:** `docs/` (from utils branch)
- **Tests:** `project-files/testsprite/`
- **Builds:** `project-files/dist/`
- **Backups:** `project-files/backups/`
- **Certificates:** `project-files/app-certificate-requests/`

---

## ğŸš€ Deployment Workflows

### Standard Deploy
```bash
# 1. Make changes to code
cd /Users/Michele/Sites/mxmlscores

# 2. Build
npm run build

# 3. Deploy to production
./scripts/deploy-production.sh

# 4. Test
open https://cloud.ottoniascoppio.org/index.php/apps/mxmlscores
# Hard refresh: Cmd+Shift+R
```

### Deploy and Test
```bash
cd /Users/Michele/Sites/mxmlscores
./scripts/deploy-and-test.sh
# Builds, deploys, and runs automated tests
```

### Create Release Package
```bash
cd /Users/Michele/Sites/mxmlscores
./scripts/package-app.sh
# Creates: project-files/dist/mxmlscores-*.tar.gz
```

---

## ğŸ” Troubleshooting

### If app doesn't load:
1. Check browser console for errors
2. Hard refresh (Cmd+Shift+R)
3. Verify files on server:
   ```bash
   ssh ottoniascoppio "ls -lh /home/ottoniascoppio/domains/cloud.ottoniascoppio.org/public_html/apps/mxmlscores/js/"
   ```
4. Check app is enabled:
   ```bash
   ssh ottoniascoppio "cd /home/ottoniascoppio/domains/cloud.ottoniascoppio.org/public_html && php occ app:list | grep mxmlscores"
   ```

### If permissions error:
```bash
ssh ottoniascoppio "sudo chown -R ottoniascoppio:ottoniascoppio /home/ottoniascoppio/domains/cloud.ottoniascoppio.org/public_html/apps/mxmlscores"
ssh ottoniascoppio "chmod -R 755 /home/ottoniascoppio/domains/cloud.ottoniascoppio.org/public_html/apps/mxmlscores"
```

---

## âœ… Post-Deployment Checklist

After running any deploy script:

- [ ] App loads without errors
- [ ] MusicXML files can be opened
- [ ] Playback controls work
- [ ] Admin settings accessible
- [ ] Public sharing works
- [ ] No console errors
- [ ] No 404 errors
- [ ] Sidebar displays correctly
- [ ] Modal dialogs work

---

## ğŸ”— Related Files and Documentation

- **App Root:** `/Users/Michele/Sites/mxmlscores/`
- **Scripts:** `scripts/` (from utils branch)
- **Documentation:** `docs/` (from utils branch)
- **Tests:** `project-files/testsprite/`
- **Build Config:** `vite.config.js`
- **Package Info:** `package.json`
- **App Info:** `appinfo/info.xml`
- **Changelog:** `project-files/CHANGELOG.md`
- **License:** `project-files/LICENSE`
- **Test Report:** `project-files/TEST_REPORT.md`

## ğŸ“š More Information

For detailed documentation, checkout the utils branch:
```bash
cd /Users/Michele/Sites/mxmlscores
git checkout utils -- docs/
# View docs/DEPLOY_CHECKLIST.md, docs/WORKFLOW.md, etc.
```

---

**Last Updated:** November 11, 2025
**Maintained By:** Michele
**App Version:** 0.9.5
